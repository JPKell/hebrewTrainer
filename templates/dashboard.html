{% extends "base.html" %}

{% block title %}Dashboard â€” Hebrew Trainer{% endblock %}

{% block content %}
<div class="space-y-8">

  <!-- Page header -->
  <div class="text-center pt-2">
    <h1 class="text-3xl font-bold text-gray-100 tracking-tight">Hebrew Sight Reading</h1>
    <p class="text-gray-500 text-sm mt-1">Modern Israeli Pronunciation Trainer</p>
  </div>

  <!-- Stats row -->
  <div class="grid grid-cols-3 gap-3">
    <div class="bg-gray-900 rounded-2xl p-4 text-center border border-gray-800">
      <div class="text-3xl font-bold text-indigo-400">{{ stats.current_streak }}</div>
      <div class="text-xs text-gray-500 mt-1 leading-tight">Day<br>Streak</div>
      {% if stats.current_streak >= 3 %}<div class="text-base mt-1">ğŸ”¥</div>{% endif %}
    </div>
    <div class="bg-gray-900 rounded-2xl p-4 text-center border border-gray-800">
      <div class="text-3xl font-bold text-amber-400">{{ stats.longest_streak }}</div>
      <div class="text-xs text-gray-500 mt-1 leading-tight">Best<br>Streak</div>
      <div class="text-base mt-1">ğŸ†</div>
    </div>
    <div class="bg-gray-900 rounded-2xl p-4 text-center border border-gray-800">
      <div class="text-2xl font-bold text-emerald-400 leading-tight">{{ stats.total_time_seconds | fmt_duration }}</div>
      <div class="text-xs text-gray-500 mt-1 leading-tight">Total<br>Time</div>
      <div class="text-base mt-1">â±ï¸</div>
    </div>
  </div>

  <!-- Training Plan card -->
  <div class="bg-gray-900 border border-indigo-800/50 rounded-2xl p-5">
    <div class="flex items-start justify-between mb-3">
      <div>
        <div class="text-xs font-semibold text-indigo-400 uppercase tracking-widest">{{ plan_weeks }}-Week Plan</div>
        <div class="text-gray-100 font-semibold mt-1">Week {{ current_week }} â€” {{ current_week_plan.title }}</div>
        <div class="text-xs text-gray-600 mt-0.5">{{ current_week_plan.phase }}</div>
      </div>
      <div class="text-right shrink-0 ml-4">
        <div class="text-3xl font-bold text-indigo-400">{{ current_week }}</div>
        <div class="text-xs text-gray-600">of {{ plan_weeks }}</div>
      </div>
    </div>

    <!-- Progress bar -->
    <div class="bg-gray-800 rounded-full h-1.5 mb-3">
      <div class="bg-indigo-500 h-1.5 rounded-full transition-all"
           style="width: {{ (((current_week - 1) / plan_weeks) * 100) | round | int }}%"></div>
    </div>

    <!-- Milestone -->
    <div class="flex items-start gap-2 text-sm text-gray-400 mb-4">
      <span class="text-amber-400 shrink-0">&#127919;</span>
      <span>{{ current_week_plan.milestone }}</span>
    </div>

    <!-- Today's drill progress -->
    {% set total_today = today_drill_rows | sum(attribute='done') %}
    <div class="border-t border-gray-800/70 pt-4 mb-4">
      <div class="flex items-center justify-between mb-3">
        <span class="text-xs font-semibold text-gray-600 uppercase tracking-widest">Today's Goal</span>
        {% set week_today = today_drill_rows | selectattr('mode', 'in', current_week_plan.recommended_modes) | sum(attribute='done') %}
        <span class="text-xs font-bold tabular-nums
          {% if week_today > 0 %}text-gray-300{% else %}text-gray-600{% endif %}">
          {{ week_today }} min
        </span>
      </div>
      <div class="space-y-2">
        {% for row in today_drill_rows %}
        {% if row.mode in current_week_plan.recommended_modes %}
        <div class="flex items-center gap-3">
          <span class="text-xs w-20 shrink-0 capitalize
            {% if row.done > 0 %}text-gray-400{% else %}text-gray-700{% endif %}">
            {{ 'vowels' if row.mode == 'letters' else row.mode }}
          </span>
          <div class="flex-1 bg-gray-800 rounded-full h-1.5 overflow-hidden">
            <div class="h-1.5 rounded-full transition-all
              {% if row.mode == 'consonants' %}bg-rose-500
              {% elif row.mode == 'letters' %}bg-indigo-500
              {% elif row.mode == 'vowelfire' %}bg-purple-500
              {% elif row.mode == 'words' %}bg-violet-500
              {% elif row.mode == 'phrases' %}bg-sky-500
              {% elif row.mode == 'siddur' %}bg-teal-500
              {% else %}bg-amber-500{% endif %}"
              style="width: {{ row.pct }}%">
            </div>
          </div>
          <span class="text-xs tabular-nums w-14 text-right
            {% if row.done >= row.target %}text-emerald-400 font-semibold
            {% elif row.done > 0 %}text-gray-500
            {% else %}text-gray-700{% endif %}">
            {{ row.done }}/{{ row.target }}m
          </span>
        </div>
        {% endif %}
        {% endfor %}
      </div>
    </div>

    <!-- Recommended drills -->
    <div class="flex flex-wrap gap-2 mb-4">
      {% for mode in current_week_plan.recommended_modes %}
      <a href="/drill/{{ mode }}"
         class="text-sm px-4 py-1.5 rounded-xl font-medium transition-colors
         {% if mode == 'letters' %}bg-indigo-900/60 text-indigo-400 hover:bg-indigo-800/80
         {% elif mode == 'vowelfire' %}bg-purple-900/60 text-purple-400 hover:bg-purple-800/80
         {% elif mode == 'words' %}bg-violet-900/60 text-violet-400 hover:bg-violet-800/80
         {% elif mode == 'phrases' %}bg-sky-900/60 text-sky-400 hover:bg-sky-800/80
         {% elif mode == 'consonants' %}bg-rose-900/60 text-rose-400 hover:bg-rose-800/80
         {% elif mode == 'siddur' %}bg-teal-900/60 text-teal-400 hover:bg-teal-800/80
         {% else %}bg-amber-900/60 text-amber-400 hover:bg-amber-800/80{% endif %}">
        {{ 'Vowels' if mode == 'letters' else mode | capitalize }}
      </a>
      {% endfor %}
    </div>

    <a href="/guide" class="text-xs text-indigo-500 hover:text-indigo-400 transition-colors">View full {{ plan_weeks }}-week plan â†’</a>
  </div>

  <!-- Drill modes -->
  <div>
    <h2 class="text-xs font-semibold text-gray-600 uppercase tracking-widest mb-3">Start a Drill</h2>
    <div class="space-y-3">

      <a href="/drill/consonants"
         class="drill-card group flex items-center gap-4 bg-gray-900 hover:bg-gray-800/80 border border-gray-800 hover:border-rose-700/60 rounded-2xl p-5 transition-all">
        <div class="w-12 h-12 rounded-xl bg-rose-950 flex items-center justify-center shrink-0">
          <span class="text-2xl font-hebrew text-rose-300">×</span>
        </div>
        <div class="flex-1 min-w-0">
          <div class="font-semibold text-gray-100">Rapid-Fire Consonants</div>
          <div class="text-sm text-gray-500 mt-0.5">Bare letters â€” no vowels, random order</div>
        </div>
        <div class="text-gray-600 group-hover:text-rose-400 transition-colors text-lg">â€º</div>
      </a>

      <a href="/drill/letters"
         class="drill-card group flex items-center gap-4 bg-gray-900 hover:bg-gray-800/80 border border-gray-800 hover:border-indigo-700/60 rounded-2xl p-5 transition-all">
        <div class="w-12 h-12 rounded-xl bg-indigo-950 flex items-center justify-center shrink-0">
          <span class="text-xl font-hebrew text-indigo-300">××‘×’</span>
        </div>
        <div class="flex-1 min-w-0">
          <div class="font-semibold text-gray-100">Vowel Drills</div>
          <div class="text-sm text-gray-500 mt-0.5">Every vowel on base consonants</div>
        </div>
        <div class="text-gray-600 group-hover:text-indigo-400 transition-colors text-lg">â€º</div>
      </a>

      <a href="/drill/vowelfire"
         class="drill-card group flex items-center gap-4 bg-gray-900 hover:bg-gray-800/80 border border-gray-800 hover:border-purple-700/60 rounded-2xl p-5 transition-all">
        <div class="w-12 h-12 rounded-xl bg-purple-950 flex items-center justify-center shrink-0">
          <span class="text-xl font-hebrew text-purple-300">×‘Ö¸×’Ö·</span>
        </div>
        <div class="flex-1 min-w-0">
          <div class="font-semibold text-gray-100">Rapid-Fire Vowels</div>
          <div class="text-sm text-gray-500 mt-0.5">Random consonantâ€¯+â€¯vowel pairs, auto-play</div>
        </div>
        <div class="text-gray-600 group-hover:text-purple-400 transition-colors text-lg">â€º</div>
      </a>

      <a href="/drill/words"
         class="drill-card group flex items-center gap-4 bg-gray-900 hover:bg-gray-800/80 border border-gray-800 hover:border-violet-700/60 rounded-2xl p-5 transition-all">
        <div class="w-12 h-12 rounded-xl bg-violet-950 flex items-center justify-center shrink-0">
          <span class="text-xl font-hebrew text-violet-300">×‘Ö¸Ö¼×¨×•Ö¼×šÖ°</span>
        </div>
        <div class="flex-1 min-w-0">
          <div class="font-semibold text-gray-100">Word Reading</div>
          <div class="text-sm text-gray-500 mt-0.5">Hebrew words from prayer &amp; everyday use</div>
        </div>
        <div class="text-gray-600 group-hover:text-violet-400 transition-colors text-lg">â€º</div>
      </a>

      <a href="/drill/phrases"
         class="drill-card group flex items-center gap-4 bg-gray-900 hover:bg-gray-800/80 border border-gray-800 hover:border-sky-700/60 rounded-2xl p-5 transition-all">
        <div class="w-12 h-12 rounded-xl bg-sky-950 flex items-center justify-center shrink-0">
          <span class="text-xl font-hebrew text-sky-300">×©×œ×•×</span>
        </div>
        <div class="flex-1 min-w-0">
          <div class="font-semibold text-gray-100">Phrase Flow</div>
          <div class="text-sm text-gray-500 mt-0.5">Common words and expressions</div>
        </div>
        <div class="text-gray-600 group-hover:text-sky-400 transition-colors text-lg">â€º</div>
      </a>

      <a href="/drill/prayer"
         class="drill-card group flex items-center gap-4 bg-gray-900 hover:bg-gray-800/80 border border-gray-800 hover:border-amber-700/60 rounded-2xl p-5 transition-all">
        <div class="w-12 h-12 rounded-xl bg-amber-950 flex items-center justify-center shrink-0">
          <span class="text-xl font-hebrew text-amber-300">×©××¢</span>
        </div>
        <div class="flex-1 min-w-0">
          <div class="font-semibold text-gray-100">Prayer Simulation</div>
          <div class="text-sm text-gray-500 mt-0.5">Traditional prayer phrases</div>
        </div>
        <div class="text-gray-600 group-hover:text-amber-400 transition-colors text-lg">â€º</div>
      </a>

      <a href="/drill/siddur"
         class="drill-card group flex items-center gap-4 bg-gray-900 hover:bg-gray-800/80 border border-gray-800 hover:border-teal-700/60 rounded-2xl p-5 transition-all">
        <div class="w-12 h-12 rounded-xl bg-teal-950 flex items-center justify-center shrink-0">
          <span class="text-2xl text-teal-300">ğŸ“–</span>
        </div>
        <div class="flex-1 min-w-0">
          <div class="font-semibold text-gray-100">Siddur Reading</div>
          <div class="text-sm text-gray-500 mt-0.5">Open siddur â€” timed free-reading session</div>
        </div>
        <div class="text-gray-600 group-hover:text-teal-400 transition-colors text-lg">â€º</div>
      </a>

    </div>
  </div>

  <!-- Recent sessions -->
  {% if recent_sessions %}
  <div>
    <h2 class="text-xs font-semibold text-gray-600 uppercase tracking-widest mb-3">Recent Sessions</h2>
    <div class="bg-gray-900 rounded-2xl border border-gray-800 overflow-hidden">
      {% for session in recent_sessions %}
      <div class="flex items-center justify-between px-4 py-3
                  {% if not loop.last %}border-b border-gray-800{% endif %}">
        <div class="flex items-center gap-3">
          <span class="w-2 h-2 rounded-full
            {% if session.mode == 'letters' %}bg-indigo-500
            {% elif session.mode == 'vowelfire' %}bg-purple-500
            {% elif session.mode == 'words' %}bg-violet-500
            {% elif session.mode == 'phrases' %}bg-sky-500
            {% elif session.mode == 'consonants' %}bg-rose-500
            {% elif session.mode == 'siddur' %}bg-teal-500
            {% else %}bg-amber-500{% endif %}"></span>
          <span class="text-sm text-gray-300 capitalize">{{ 'vowels' if session.mode == 'letters' else ('vowel fire' if session.mode == 'vowelfire' else session.mode) }}</span>
        </div>
        <div class="flex items-center gap-4 text-sm text-gray-500">
          <span>{{ session.duration_seconds | fmt_duration }}</span>
          <span>{{ session.date.strftime('%b %-d') }}</span>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
  {% endif %}

  <!-- Pronunciation link -->
  <div class="text-center pb-2">
    <a href="/pronunciation" class="text-sm text-indigo-400 hover:text-indigo-300 transition-colors">
      View Pronunciation Guide â†’
    </a>
  </div>

</div>
{% endblock %}
